(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{542:function(t,a,s){"use strict";s.r(a);var n=s(24),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"requestanimationframe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requestanimationframe"}},[t._v("#")]),t._v(" requestAnimationFrame")]),t._v(" "),s("p",[t._v("在 web 应用中，我们可以用很多中方法去实现一个动画。 "),s("code",[t._v("requestAnimationFrame")]),t._v("在渲染之前执行。")]),t._v(" "),s("p",[t._v("JS 动画：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("setTimeout")]),t._v(" 或 "),s("code",[t._v("setInterval")]),t._v("定时器（容易卡顿、抖动）")]),t._v(" "),s("li",[s("code",[t._v("canvas")]),t._v(" 画布（js 操作画笔）")]),t._v(" "),s("li",[s("code",[t._v("requestAnimationFrame")]),t._v(" 帧动画（推荐）")])]),t._v(" "),s("p",[t._v("CSS3 动画:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("transition")]),t._v(" 过渡动画")]),t._v(" "),s("li",[s("code",[t._v("animation")]),t._v(" 直接动画")])]),t._v(" "),s("h2",{attrs:{id:"原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),s("p",[t._v("我们知道，在浏览器中，页面是一帧一帧绘制出来的，渲染的帧率与设备的刷新率保持一致。一般情况下设备的屏幕刷新率为 1s 60 次，就是说浏览器的刷新频率是 60HZ，那么一帧的时间就是大约 16ms。浏览器在一帧内会做哪些事情：")]),t._v(" "),s("ol",[s("li",[t._v("处理用户输入事件 。")]),t._v(" "),s("li",[t._v("javascript 执行。")]),t._v(" "),s("li",[t._v("requestAnimationFrame 调用。")]),t._v(" "),s("li",[t._v("布局 Layout。")]),t._v(" "),s("li",[t._v("绘制 Point。")]),t._v(" "),s("li",[t._v("requestIdleCallback （是否剩余时间）")])]),t._v(" "),s("p",[t._v("浏览器会在每次绘制之前 执行 "),s("code",[t._v("requestAnimationFrame()")]),t._v("，如果上一帧的第二步的执行时间超过了 16ms，那么也会造成失帧.")]),t._v(" "),s("h2",{attrs:{id:"用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[t._v("#")]),t._v(" 用法")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// requestAnimationFrame请求动画帧方式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrameFn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   *  这里执行动画绘制\n   */")]),t._v("\n\n  window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestAnimationFrameFn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在浏览器下一次绘制之前执行。")]),t._v("\nwindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestAnimationFrameFn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h2",{attrs:{id:"优点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[t._v("#")]),t._v(" 优点")]),t._v(" "),s("ol",[s("li",[t._v("当页面隐藏时、未处于激活状态下，requestAnimationFrame 暂停执行，节省 CPU 资源。")]),t._v(" "),s("li",[t._v("setTimeout 和 setInterval 实际的执行时间是固定的，导致与浏览器（浏览器的刷新频率紧跟设备的刷新频率）的刷新频率不一致，导致掉帧的情况发生。")]),t._v(" "),s("li",[t._v("requestAnimationFrame 会在每一帧绘制之前执行完成，和浏览器的刷新频率保持一致，不会丢帧（除非 JS 阻塞）。")]),t._v(" "),s("li",[t._v("用于函数节流，一帧之内只执行一次。")])]),t._v(" "),s("h2",{attrs:{id:"缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),s("ol",[s("li",[t._v("多次绑定 "),s("code",[t._v("requestAnimationFrame")]),t._v(" 函数会导致在同一个帧内多次触发执行。因此保证同一时间内 "),s("code",[t._v("requestAnimationFrame")]),t._v(" 只会被调用一次。")]),t._v(" "),s("li",[t._v("如果"),s("code",[t._v("requestAnimationFrame")]),t._v("中的回调函数逻辑复杂，也有可能会造成失帧。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);