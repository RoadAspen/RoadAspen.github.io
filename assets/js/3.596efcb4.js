(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{365:function(s,t,a){s.exports=a.p+"assets/img/zhenzhixing.591da4ae.png"},366:function(s,t,a){s.exports=a.p+"assets/img/fiberdiaodu.c9faee6c.png"},367:function(s,t,a){s.exports=a.p+"assets/img/workLoop.25b47dfc.png"},368:function(s,t,a){s.exports=a.p+"assets/img/fiber.016fb5d7.png"},543:function(s,t,a){"use strict";a.r(t);var n=a(24),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"reactfiber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reactfiber"}},[s._v("#")]),s._v(" ReactFiber")]),s._v(" "),n("p",[n("code",[s._v("Fiber æ•°æ®ç»“æ„")]),s._v(" + "),n("code",[s._v("ç®—æ³•")]),s._v(" = "),n("code",[s._v("Fiberæ¶æ„")]),s._v("ã€‚")]),s._v(" "),n("h2",{attrs:{id:"ä¸ºä»€ä¹ˆè¦æœ‰-fiber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆè¦æœ‰-fiber"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆè¦æœ‰ Fiber")]),s._v(" "),n("p",[s._v("javascript å¼•æ“æ˜¯åœ¨"),n("strong",[s._v("å•çº¿ç¨‹")]),s._v("è¿è¡Œçš„ã€‚ä¸¥æ ¼æ¥è®²ï¼Œ"),n("strong",[s._v("js å¼•æ“å’Œé¡µé¢æ¸²æŸ“å¼•æ“åœ¨åŒä¸€ä¸ªæ¸²æŸ“çº¿ç¨‹ï¼Œ GUI æ¸²æŸ“å’Œ JS æ‰§è¡Œæ˜¯äº’æ–¥çš„ã€‚")]),n("br"),s._v(" "),n("strong",[s._v("React V15 åœ¨æ›´æ–°æ—¶ï¼Œä¼šé€’å½’å¯¹æ¯” VirtualDOM æ ‘ï¼Œæ‰¾å‡ºéœ€è¦å˜åŠ¨çš„èŠ‚ç‚¹ï¼Œç„¶ååŒæ­¥æ›´æ–°å®ƒä»¬ï¼Œä¸€æ°”å‘µæˆã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ React ä¸­è¢«ç§°ä¸º Reconciliation (åè°ƒ)")]),s._v("ï¼Œåè°ƒ æ˜¯ä¸€ä¸ªå¾ˆè€—æ—¶çš„ CPU å¯†é›†å‹æ“ä½œï¼Œåœ¨åè°ƒæœŸé—´ï¼ŒReact ä¼šä¸€ç›´å ç”¨ CPU èµ„æºï¼Œå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š")]),s._v(" "),n("ol",[n("li",[s._v("ç”¨æˆ·è§¦å‘çš„äº‹ä»¶å¾—ä¸åˆ°å“åº”")]),s._v(" "),n("li",[s._v("GUI æ¸²æŸ“å»¶è¿Ÿï¼Œå¯¼è‡´é¡µé¢æ‰å¸§ï¼Œç”¨æˆ·æ„Ÿè§‰é¡µé¢å¡é¡¿ã€‚")])]),s._v(" "),n("p",[s._v("å› æ­¤ React å›¢é˜Ÿåœ¨ V16 ç‰ˆæœ¬ä¸­å¼•å…¥äº† "),n("code",[s._v("Fiber æ¶æ„")]),s._v("ï¼Œ é€šè¿‡ "),n("code",[s._v("Fiber æ¶æ„")]),s._v(" ï¼Œå°† "),n("code",[s._v("Reconciliation")]),s._v(" è¿‡ç¨‹ å˜ä¸º"),n("strong",[s._v("å¯è¢«ä¸­æ–­")]),s._v("ã€‚â€˜é€‚æ—¶â€™çš„è®©å‡º CPU æ‰§è¡Œæƒï¼Œé™¤äº†è®©æµè§ˆå™¨åŠæ—¶çš„å“åº”ç”¨æˆ·çš„äº¤äº’ï¼Œè¿˜æœ‰å…¶å®ƒå¥½å¤„ï¼š")]),s._v(" "),n("ol",[n("li",[s._v("ä¸å…¶ä¸€æ¬¡æ€§æ“ä½œå¤§é‡ DOM èŠ‚ç‚¹ç›¸æ¯”, åˆ†æ‰¹å»¶æ—¶å¯¹ DOM è¿›è¡Œæ“ä½œï¼Œå¯ä»¥å¾—åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚")]),s._v(" "),n("li",[s._v("ç»™æµè§ˆå™¨ä¸€ç‚¹å–˜æ¯çš„æœºä¼šï¼Œä»–ä¼šå¯¹ä»£ç è¿›è¡Œç¼–è¯‘ä¼˜åŒ–ï¼ˆJITï¼‰åŠè¿›è¡Œçƒ­ä»£ç ä¼˜åŒ–ï¼Œæˆ–è€…å¯¹ reflow è¿›è¡Œä¿®æ­£.")])]),s._v(" "),n("h2",{attrs:{id:"ä½•ä¸º-fiber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä½•ä¸º-fiber"}},[s._v("#")]),s._v(" ä½•ä¸º Fiber")]),s._v(" "),n("p",[s._v("å¯¹äº React æ¥è®²ï¼ŒFiber å¯ä»¥ä»ä¸¤ä¸ªè§’åº¦ç†è§£ï¼š")]),s._v(" "),n("h3",{attrs:{id:"_1-ä¸€ç§æµç¨‹æ§åˆ¶è¯­å¥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä¸€ç§æµç¨‹æ§åˆ¶è¯­å¥"}},[s._v("#")]),s._v(" 1. ä¸€ç§æµç¨‹æ§åˆ¶è¯­å¥")]),s._v(" "),n("p",[s._v("Fiber ä¹Ÿç§°ä¸º "),n("code",[s._v("åç¨‹")]),s._v(",ä¸çº¿ç¨‹ä¸åŒï¼Œæ˜¯ä¸€ç§æ§åˆ¶æµç¨‹çš„è®©å‡ºæœºåˆ¶ã€‚ç±»ä¼¼äº "),n("code",[s._v("Generator")]),s._v(" å‡½æ•°ï¼š")]),s._v(" "),n("p",[s._v("æ™®é€šçš„å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ ä¸èƒ½è¢«"),n("strong",[s._v("ä¸­æ–­å’Œæ¢å¤")]),s._v("ï¼š")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tasks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tasks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("shift")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("è€Œ "),n("code",[s._v("Generator")]),s._v("å¯ä»¥ï¼š")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tasks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tasks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("shift")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­æ˜¯å¦æœ‰é«˜ä¼˜å…ˆçº§äº‹ä»¶éœ€è¦å¤„ç†, æœ‰çš„è¯è®©å‡ºæ§åˆ¶æƒ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasHighPriorityEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†å®Œé«˜ä¼˜å…ˆçº§äº‹ä»¶åï¼Œæ¢å¤å‡½æ•°è°ƒç”¨æ ˆï¼Œç»§ç»­æ‰§è¡Œ...")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("React Fiber çš„æ€æƒ³å’Œ åç¨‹çš„æ¦‚å¿µæ˜¯ç›¸å¥‘åˆçš„ï¼š"),n("strong",[s._v("React æ¸²æŸ“çš„è¿‡ç¨‹å¯ä»¥è¢«ä¸­æ–­ï¼Œå¯ä»¥å°†æ§åˆ¶æƒäº¤å›ç»™æµè§ˆå™¨ï¼Œè®©ä½ç»™é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæµè§ˆå™¨ç©ºé—²åå†æ¢å¤æ¸²æŸ“ã€‚")])]),s._v(" "),n("ol",[n("li",[s._v("React Fiber é‡‡ç”¨äº†ä¸»åŠ¨è®©å‡ºæœºåˆ¶ã€‚")]),s._v(" "),n("li",[s._v("é€šè¿‡ requestIdleCallback API æ¥å†³å®šæ˜¯å¦äº¤å‡ºæ§åˆ¶æƒã€‚"),n("code",[s._v("requestIdleCallback")]),s._v(" çš„æ„æ€æ˜¯æŒ‡"),n("strong",[s._v("è®©æµè§ˆå™¨æœ‰ç©ºçš„æ—¶å€™å°±æ‰§è¡Œæˆ‘ä»¬çš„å›è°ƒï¼Œè¿™ä¸ªå›è°ƒä¼šä¼ å…¥ä¸€ä¸ªæœŸé™ï¼Œè¡¨ç¤ºæµè§ˆå™¨æœ‰å¤šå°‘æ—¶é—´ä¾›æˆ‘ä»¬æ‰§è¡Œï¼Œä¸ºäº†ä¸è€½è¯¯äº‹ï¼Œæˆ‘ä»¬æœ€å¥½åœ¨è¿™ä¸ªæ—¶é—´èŒƒå›´å†…æ‰§è¡Œå®Œæ¯•")])])]),s._v(" "),n("p",[s._v("ä¸€èˆ¬æƒ…å†µä¸‹æµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯ 60HZï¼Œé‚£ä¹ˆä¸€å¸§çš„æ—¶é—´å°±æ˜¯å¤§çº¦ 16msã€‚æµè§ˆå™¨åœ¨ä¸€å¸§å†…ä¼šåšå“ªäº›äº‹æƒ…ï¼š")]),s._v(" "),n("p",[n("img",{attrs:{src:a(365),alt:"å¸§æ‰§è¡Œ"}})]),s._v(" "),n("ol",[n("li",[s._v("å¤„ç†ç”¨æˆ·è¾“å…¥äº‹ä»¶ã€‚")]),s._v(" "),n("li",[s._v("javascript æ‰§è¡Œã€‚")]),s._v(" "),n("li",[s._v("requestAnimationFrame è°ƒç”¨ã€‚")]),s._v(" "),n("li",[s._v("å¸ƒå±€ Layoutã€‚")]),s._v(" "),n("li",[s._v("ç»˜åˆ¶ Pointã€‚")]),s._v(" "),n("li",[s._v("requestIdleCallback ï¼ˆæ˜¯å¦å‰©ä½™æ—¶é—´ï¼‰")])]),s._v(" "),n("p",[s._v("å¦‚æœæµè§ˆå™¨å¤„ç†å®Œä¸Šè¿°äº‹æƒ…ä¹‹åè¿˜æœ‰å‰©ä½™çš„æ—¶é—´ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šè°ƒç”¨ "),n("code",[s._v("requestIdleCallback")]),s._v("å›è°ƒã€‚")]),s._v(" "),n("p",[n("strong",[s._v("ä½†æ˜¯åœ¨æµè§ˆå™¨ç¹å¿™çš„æ—¶å€™ï¼Œå¯èƒ½ä¸ä¼šæœ‰ç›ˆä½™æ—¶é—´ï¼Œè¿™æ—¶å€™ "),n("code",[s._v("requestIdleCallback")]),s._v(" å›è°ƒå¯èƒ½å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚ ä¸ºäº†é¿å…é¥¿æ­»ï¼Œå¯ä»¥é€šè¿‡ "),n("code",[s._v("requestIdleCallback")]),s._v(" çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚")])]),s._v(" "),n("h4",{attrs:{id:"ä»»åŠ¡ä¼˜å…ˆçº§"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»»åŠ¡ä¼˜å…ˆçº§"}},[s._v("#")]),s._v(" ä»»åŠ¡ä¼˜å…ˆçº§")]),s._v(" "),n("p",[s._v("ä¸ºäº†é¿å…ä»»åŠ¡è¢«é¥¿æ­»ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´. "),n("strong",[s._v("è¿™ä¸ªè¶…æ—¶æ—¶é—´ä¸æ˜¯æ­»çš„ï¼Œä½ä¼˜å…ˆçº§çš„å¯ä»¥æ…¢æ…¢ç­‰å¾…, é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡åº”è¯¥ç‡å…ˆè¢«æ‰§è¡Œ")]),s._v(". ç›®å‰ React é¢„å®šä¹‰äº† 5 ä¸ªä¼˜å…ˆçº§:")]),s._v(" "),n("ul",[n("li",[s._v("Immediate(-1) - è¿™ä¸ªä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼š"),n("strong",[s._v("åŒæ­¥æ‰§è¡Œ")]),s._v(", æˆ–è€…è¯´è¦"),n("strong",[s._v("é©¬ä¸Šæ‰§è¡Œä¸”ä¸èƒ½ä¸­æ–­")])]),s._v(" "),n("li",[s._v("UserBlocking(250ms) è¿™äº›ä»»åŠ¡ä¸€èˆ¬æ˜¯ç”¨æˆ·äº¤äº’çš„ç»“æœ, "),n("strong",[s._v("éœ€è¦å³æ—¶å¾—åˆ°åé¦ˆ")])]),s._v(" "),n("li",[s._v("Normal (5s) åº”å¯¹å“ªäº›"),n("strong",[s._v("ä¸éœ€è¦ç«‹å³æ„Ÿå—åˆ°çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚")])]),s._v(" "),n("li",[s._v("Low (10s) "),n("strong",[s._v("è¿™äº›ä»»åŠ¡å¯ä»¥æ”¾åï¼Œä½†æ˜¯æœ€ç»ˆåº”è¯¥å¾—åˆ°æ‰§è¡Œ")]),s._v(". ä¾‹å¦‚åˆ†æé€šçŸ¥")]),s._v(" "),n("li",[s._v("Idle (æ²¡æœ‰è¶…æ—¶æ—¶é—´) ä¸€äº›æ²¡æœ‰å¿…è¦åšçš„ä»»åŠ¡ (e.g. æ¯”å¦‚éšè—çš„å†…å®¹), å¯èƒ½ä¼šè¢«é¥¿æ­»")])]),s._v(" "),n("h3",{attrs:{id:"_2-ä¸€ä¸ªæ‰§è¡Œå•å…ƒ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä¸€ä¸ªæ‰§è¡Œå•å…ƒ"}},[s._v("#")]),s._v(" 2. ä¸€ä¸ªæ‰§è¡Œå•å…ƒ")]),s._v(" "),n("p",[s._v("Fiber çš„å¦å¤–ä¸€ç§è§£è¯»æ˜¯â€™çº¤ç»´â€˜: è¿™æ˜¯ä¸€ç§æ•°æ®ç»“æ„æˆ–è€…è¯´æ‰§è¡Œå•å…ƒã€‚å°†å®ƒè§†ä½œä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ª'æ‰§è¡Œå•å…ƒ', React å°±ä¼šæ£€æŸ¥ç°åœ¨è¿˜å‰©å¤šå°‘æ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´å°±å°†æ§åˆ¶æƒè®©å‡ºå».äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š")]),s._v(" "),n("p",[n("img",{attrs:{src:a(366),alt:"fiberè°ƒåº¦"}})]),s._v(" "),n("p",[s._v("å‡è®¾ç”¨æˆ·è°ƒç”¨ "),n("code",[s._v("setState")]),s._v(" æ›´æ–°ç»„å»ºï¼Œè¿™ä¸ªå¸¦æ›´æ–°çš„ä»»åŠ¡ä¼šå…ˆæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡ "),n("code",[s._v("requestIdleCallback")]),s._v("è¯·æ±‚æµè§ˆå™¨è°ƒåº¦ã€‚")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("updateQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("updateTask"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestIdleCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("performWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" timeout "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("ç°åœ¨æµè§ˆå™¨æœ‰ç©ºé—²æˆ–è€…è¶…æ—¶äº†ï¼Œå°±ä¼šè°ƒç”¨ "),n("code",[s._v("performWork")]),s._v(" æ¥æ‰§è¡Œä»»åŠ¡ï¼š")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1ï¸âƒ£ performWork ä¼šæ‹¿åˆ°ä¸€ä¸ªDeadlineï¼Œè¡¨ç¤ºå‰©ä½™æ—¶é—´")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("performWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("deadline")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2ï¸âƒ£ å¾ªç¯å–å‡ºupdateQueueä¸­çš„ä»»åŠ¡")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("updateQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" deadline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeRemaining")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENOUGH_TIME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("workLoop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deadline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3ï¸âƒ£ å¦‚æœåœ¨æœ¬æ¬¡æ‰§è¡Œä¸­ï¼Œæœªèƒ½å°†æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œé‚£å°±å†è¯·æ±‚æµè§ˆå™¨è°ƒåº¦")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("updateQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestIdleCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("performWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("code",[s._v("workLoop")]),s._v(" çš„å·¥ä½œå¤§æ¦‚çŒœåˆ°äº†ï¼Œä»–å°±æ˜¯ä» æ›´æ–°é˜Ÿåˆ—ä¸­ è·å–æ›´æ–°ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæ¯æ‰§è¡Œå®Œä¸€ä¸ª"),n("code",[s._v("æ‰§è¡Œå•å…ƒ")]),s._v("ï¼Œå°±æ£€æŸ¥ä¸€ä¸‹å‰©ä½™æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³å°±ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª"),n("code",[s._v("æ‰§è¡Œå•å…ƒ")]),s._v("ï¼Œå¦åˆ™å°±äº¤å‡ºæ§åˆ¶æƒï¼Œä¿å­˜ç°åœºï¼Œå¹¶è¯·æ±‚ä¸‹ä¸€æ¬¡æ‰§è¡Œæƒé™ï¼š")]),s._v(" "),n("div",{staticClass:"language-typescript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜å½“å‰çš„å¤„ç†ç°åœº")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" nextUnitOfWork"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜ä¸‹ä¸€ä¸ªéœ€è¦å¤„ç†çš„å·¥ä½œå•å…ƒ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" topWork"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜ç¬¬ä¸€ä¸ªå·¥ä½œå•å…ƒ")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("workLoop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deadline"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" IdleDeadline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// updateQueueä¸­è·å–ä¸‹ä¸€ä¸ªæˆ–è€…æ¢å¤ä¸Šä¸€æ¬¡ä¸­æ–­çš„æ‰§è¡Œå•å…ƒ")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextUnitOfWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    nextUnitOfWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" topWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getNextUnitOfWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ğŸ”´ æ¯æ‰§è¡Œå®Œä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œæ£€æŸ¥ä¸€æ¬¡å‰©ä½™æ—¶é—´")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœè¢«ä¸­æ–­ï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œè¿˜æ˜¯ä» nextUnitOfWork å¼€å§‹å¤„ç†")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextUnitOfWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" deadline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeRemaining")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENOUGH_TIME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸‹æ–‡æˆ‘ä»¬å†çœ‹performUnitOfWork")]),s._v("\n    nextUnitOfWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("performUnitOfWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextUnitOfWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" topWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æäº¤å·¥ä½œï¼Œä¸‹æ–‡ä¼šä»‹ç»")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pendingCommit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("commitAllWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pendingCommit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("æµç¨‹å›¾å¦‚ä¸‹ï¼š")]),s._v(" "),n("p",[n("img",{attrs:{src:a(367),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"_3-æ•°æ®ç»“æ„"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ•°æ®ç»“æ„"}},[s._v("#")]),s._v(" 3. æ•°æ®ç»“æ„")]),s._v(" "),n("p",[s._v("ä¸ºäº†é…åˆ "),n("code",[s._v("Reconciliation")]),s._v(" çš„å¯ä¸­æ–­å’Œå¯æ¢å¤æ“ä½œã€‚Fiber é‡‡ç”¨äº† "),n("code",[s._v("å•å‘é“¾è¡¨")]),s._v("ï¼Œ "),n("strong",[s._v("æ¯ä¸ª VirtualDOM èŠ‚ç‚¹å†…éƒ¨ç°åœ¨ä½¿ç”¨ "),n("code",[s._v("Fiber")]),s._v(" è¡¨ç¤º")]),s._v("ï¼Œç»“æ„å¦‚ä¸‹ï¼š")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" type Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Fiber ç±»å‹ä¿¡æ¯")]),s._v("\n  type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" any"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// âš›ï¸ é“¾è¡¨ç»“æ„")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼Œæˆ–è€…renderè¯¥èŠ‚ç‚¹çš„ç»„ä»¶")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‡å‘ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹")]),s._v("\n  child"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹")]),s._v("\n  sibling"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("ç”¨å›¾ç‰‡å±•ç¤ºè¿™ä¸ªå…³ç³»ï¼š")]),s._v(" "),n("p",[n("img",{attrs:{src:a(368),alt:""}})]),s._v(" "),n("p",[s._v("æœ‰äº†è¿™ä¸ªæ•°æ®ç»“æ„è°ƒæ•´ï¼Œç°åœ¨å¯ä»¥ä»¥è¿­ä»£çš„æ–¹å¼æ¥å¤„ç†è¿™äº›èŠ‚ç‚¹äº†ã€‚æ¥çœ‹çœ‹ "),n("code",[s._v("performUnitOfWork")]),s._v(" (æ‰§è¡Œå·¥ä½œå•å…ƒ) çš„å®ç°, å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆçš„éå†ï¼š")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * @params fiber å½“å‰éœ€è¦å¤„ç†çš„èŠ‚ç‚¹\n * @params topWork æœ¬æ¬¡æ›´æ–°çš„æ ¹èŠ‚ç‚¹\n *\n * æ‰§è¡Œä¸€ä¸ªfiberï¼Œè¿”å›ä¸‹ä¸€ä¸ªfiber\n */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("performUnitOfWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("fiber"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" topWork"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Fiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œå¤„ç†")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("beginWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœå­˜åœ¨å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªå¾…å¤„ç†çš„å°±æ˜¯å­èŠ‚ç‚¹")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ²¡æœ‰å­èŠ‚ç‚¹äº†ï¼Œä¸Šæº¯æŸ¥æ‰¾å…„å¼ŸèŠ‚ç‚¹")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" temp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("completeWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ°é¡¶å±‚èŠ‚ç‚¹äº†, é€€å‡º")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("temp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" topWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰¾åˆ°ï¼Œä¸‹ä¸€ä¸ªè¦å¤„ç†çš„å°±æ˜¯å…„å¼ŸèŠ‚ç‚¹")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ²¡æœ‰, ç»§ç»­ä¸Šæº¯")]),s._v("\n    temp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("ä½ å¯ä»¥é…åˆä¸Šæ–‡çš„ "),n("code",[s._v("workLoop")]),s._v(" ä¸€èµ·çœ‹ï¼ŒFiber å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å·¥ä½œå•å…ƒï¼Œ"),n("code",[s._v("performUnitOfWork")]),s._v(" è´Ÿè´£å¯¹ "),n("code",[s._v("Fiber")]),s._v(" è¿›è¡Œæ“ä½œï¼Œå¹¶æŒ‰ç…§æ·±åº¦éå†çš„é¡ºåºè¿”å›ä¸‹ä¸€ä¸ª "),n("code",[s._v("Fiber")]),s._v(".")]),s._v(" "),n("p",[s._v("å› ä¸ºä½¿ç”¨äº†é“¾è¡¨ç»“æ„ï¼Œå³ä½¿å¤„ç†æµç¨‹è¢«ä¸­æ–­äº†ï¼Œæˆ‘ä»¬éšæ—¶å¯ä»¥ä»ä¸Šæ¬¡æœªå¤„ç†å®Œçš„ "),n("code",[s._v("Fiber")]),s._v(" ç»§ç»­éå†ä¸‹å»ã€‚")]),s._v(" "),n("h2",{attrs:{id:"fiber-æ‰§è¡ŒåŸç†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fiber-æ‰§è¡ŒåŸç†"}},[s._v("#")]),s._v(" Fiber æ‰§è¡ŒåŸç†")]),s._v(" "),n("p",[s._v("ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ¸²æŸ“å’Œè°ƒåº¦çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šrender é˜¶æ®µã€commit é˜¶æ®µã€‚")]),s._v(" "),n("ul",[n("li",[s._v("render é˜¶æ®µï¼š è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä¸­æ–­çš„ï¼Œä¼šæ‰¾å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„å˜æ›´ã€‚")]),s._v(" "),n("li",[s._v("commit é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œä¼šæ‰§è¡Œæ‰€æœ‰çš„å˜æ›´ã€‚")])]),s._v(" "),n("p",[n("strong",[s._v("è¿˜éœ€è¦äº†è§£ä»¥ä¸‹å‡ ä¸ªåè¯ï¼š")])]),s._v(" "),n("ol",[n("li",[n("code",[s._v("RootFiber")]),s._v(" ä¸æ˜¯ Fiberï¼Œ ä½†æœ‰ä¸€ä¸ª current å±æ€§æŒ‡å‘ "),n("code",[s._v("workInProgress")])]),s._v(" "),n("li",[n("code",[s._v("currentFiber æ ‘")]),s._v(" é¦–æ¬¡æ¸²æŸ“ä¹‹åï¼ŒReact ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”äº UI æ¸²æŸ“çš„ fiber æ ‘ï¼Œç§°ä¹‹ä¸º current æ ‘ã€‚åœ¨æ–°ä¸€è½®æ›´æ–°æ—¶ workInProgress tree å†é‡æ–°æ„å»ºï¼Œæ–° workInProgress çš„èŠ‚ç‚¹é€šè¿‡ alternate å±æ€§å’Œ currentFiber çš„èŠ‚ç‚¹å»ºç«‹è”ç³»ã€‚")]),s._v(" "),n("li",[n("code",[s._v("WorkInProgress æ ‘")]),s._v(" ä»£è¡¨å½“å‰æ­£åœ¨æ‰§è¡Œæ›´æ–°çš„ Fiber æ ‘ã€‚setState åä¼šç”Ÿæˆæ–°çš„ WorkInProgressã€‚ æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜çš„éƒ½æ˜¯æ–°çš„ fiber èŠ‚ç‚¹ã€‚")]),s._v(" "),n("li",[n("code",[s._v("Effect List")]),s._v(" å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨ effect å‰¯ä½œç”¨åˆ—è¡¨å®¹å™¨.")])]),s._v(" "),n("p",[n("strong",[s._v("currentFiber å’Œ WorkInProgress åŒç¼“å­˜æŠ€æœ¯ï¼Œ å‡å°‘å†…å­˜åˆ†é…å’Œ gcã€‚")])]),s._v(" "),n("h3",{attrs:{id:"render-åè°ƒé˜¶æ®µ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#render-åè°ƒé˜¶æ®µ"}},[s._v("#")]),s._v(" render åè°ƒé˜¶æ®µ")]),s._v(" "),n("p",[s._v("æ­¤é˜¶æ®µä¼šæ‰¾å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„å˜æ›´ï¼Œå¦‚èŠ‚ç‚¹æ–°å¢ã€åˆ é™¤ã€å±æ€§å˜æ›´ç­‰ï¼Œè¿™äº›å˜æ›´è¢« react ç»Ÿç§°ä¸º "),n("code",[s._v("å‰¯ä½œç”¨ï¼ˆEffect")]),s._v("ï¼‰ï¼Œæ­¤é˜¶æ®µä¼šæ„å»ºä¸€æ£µæ–°çš„ fiber tree ï¼Œå³ "),n("code",[s._v("workInProgress")]),s._v(" æ ‘ï¼Œä»¥è™šæ‹ŸèŠ‚ç‚¹ä¸ºç»´åº¦å¯¹ä»»åŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œå³ä¸€ä¸ª"),n("code",[s._v("è™šæ‹ŸDOMèŠ‚ç‚¹")]),s._v("å¯¹åº”ä¸€ä¸ª"),n("code",[s._v("ä»»åŠ¡")]),s._v("ã€‚æœ€åäº§å‡ºçš„ç»“æœæ˜¯ "),n("code",[s._v("effect list")]),s._v(",ä»ä¸­å¯ä»¥çŸ¥é“é‚£äº›èŠ‚ç‚¹æ›´æ–°ã€å¢åŠ ã€åˆ é™¤ã€‚")]),s._v(" "),n("h4",{attrs:{id:"ç”Ÿå‘½å‘¨æœŸ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿå‘½å‘¨æœŸ"}},[s._v("#")]),s._v(" ç”Ÿå‘½å‘¨æœŸ")]),s._v(" "),n("p",[s._v("render é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸï¼š")]),s._v(" "),n("ul",[n("li",[s._v("getDerivedStateFromProps")]),s._v(" "),n("li",[s._v("shouldComponentUpdate")]),s._v(" "),n("li",[s._v("render")])]),s._v(" "),n("h4",{attrs:{id:"éå†æµç¨‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#éå†æµç¨‹"}},[s._v("#")]),s._v(" éå†æµç¨‹")]),s._v(" "),n("p",[n("code",[s._v("React Fiber")]),s._v(" é¦–å…ˆå°† è™šæ‹Ÿ DOM è½¬åŒ–ä¸º "),n("code",[s._v("Fiber tree")]),s._v(", å› æ­¤æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ "),n("code",[s._v("child")]),s._v(" ã€"),n("code",[s._v("sibling")]),s._v(" ã€"),n("code",[s._v("return")])]),s._v(" "),n("p",[n("strong",[s._v("éå† Fiber tree æ—¶é‡‡ç”¨çš„æ˜¯ååºéå†æ–¹æ³•:")])]),s._v(" "),n("ul",[n("li",[s._v("ä»é¡¶éƒ¨å¼€å§‹éå†")]),s._v(" "),n("li",[s._v("å¦‚æœæœ‰ child èŠ‚ç‚¹ï¼Œä¸”è¿˜æœªéå†ï¼Œéå† child èŠ‚ç‚¹")]),s._v(" "),n("li",[s._v("å¦‚æœæ²¡æœ‰ child èŠ‚ç‚¹ï¼Œè¿”å›çˆ¶èŠ‚ç‚¹")]),s._v(" "),n("li",[s._v("å¦‚æœæœ‰ child èŠ‚ç‚¹ï¼Œä¸”å·²ç»éå†è¿‡ï¼Œåˆ™éå† sibling èŠ‚ç‚¹ã€‚")]),s._v(" "),n("li",[s._v("å¦‚æœæœ€åè¿”å›çš„èŠ‚ç‚¹ä¸ºé¡¶éƒ¨ï¼Œè¡¨ç¤ºæ‰€æœ‰èŠ‚ç‚¹éå†å®Œæˆã€‚")])]),s._v(" "),n("p",[s._v("æ¯ä¸ª Fiber ä¸Šéƒ½æœ‰ä¸ª "),n("code",[s._v("alternate")]),s._v(" å±æ€§,æŒ‡å‘ä¸€ä¸ª current Fiber æ ‘ çš„ fiber,åˆ›å»º "),n("code",[s._v("WorkInProgress")]),s._v(" èŠ‚ç‚¹æ—¶ä¼˜å…ˆå– "),n("code",[s._v("alternate")]),s._v(",æ²¡æœ‰çš„è¯å°±åˆ›å»ºä¸€ä¸ªã€‚")]),s._v(" "),n("h4",{attrs:{id:"æ”¶é›†-effect-list"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ”¶é›†-effect-list"}},[s._v("#")]),s._v(" æ”¶é›† effect list")]),s._v(" "),n("h3",{attrs:{id:"commit-æäº¤é˜¶æ®µ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#commit-æäº¤é˜¶æ®µ"}},[s._v("#")]),s._v(" commit æäº¤é˜¶æ®µ")]),s._v(" "),n("p",[s._v("è¿™ä¸ªé˜¶æ®µæ˜¯åŒæ­¥çš„ï¼Œä¸€æ°”å‘µæˆï¼Œä¸ä¼šè¢«ä¸­æ–­ã€‚ æ ¹æ® "),n("code",[s._v("effect list")]),s._v(" å»æ›´æ–°è¯•å›¾ã€‚")]),s._v(" "),n("h4",{attrs:{id:"ç”Ÿå‘½å‘¨æœŸ-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿå‘½å‘¨æœŸ-2"}},[s._v("#")]),s._v(" ç”Ÿå‘½å‘¨æœŸ")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("getSnapshotBeforeUpdate")])]),s._v(" "),n("li",[n("p",[s._v("componentDidMount")])]),s._v(" "),n("li",[n("p",[s._v("componentDidUpdate")])]),s._v(" "),n("li",[n("p",[s._v("componentWillUnmount")]),s._v(" "),n("p",[s._v("ç”±äºè¿™äº›æ–¹æ³•åœ¨æäº¤é˜¶æ®µè¢«è°ƒç”¨ï¼Œå› æ­¤å®ƒä»¬å¯èƒ½åŒ…å«ä»»ä½•å‰¯ä½œç”¨å’Œ DOM æ“ä½œã€‚")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);